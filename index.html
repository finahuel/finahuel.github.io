<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ice Cream Rolls — Pedidos</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
    :root{
        --bg:#e7f6fa;
        --accent:#f46da0;
        --accent-2:#ffd66b;
        --card:#ffffff;
        --muted:#6b6b6b;
        --shadow: 0 10px 30px rgba(12,12,12,0.06);
    }

    *{ box-sizing:border-box; }

    /* --- FIX: evitar desbordes horizontales --- */
    html, body{ overflow-x:hidden; }

    body{
        font-family:Inter,system-ui,"Helvetica Neue",Arial;
        margin:0;
        background:linear-gradient(180deg,var(--bg) 0%, #ffffff 120%);
        -webkit-font-smoothing:antialiased;
    }

    .wrap{max-width:980px;margin:0 auto;padding:18px;}
    header{display:flex;align-items:center;gap:14px;padding:10px 6px}
    .brand{display:flex;align-items:center;gap:12px;width:100%;}
    .logo{
        width:72px;height:72px;border-radius:14px;flex:0 0 72px;overflow:hidden;box-shadow:var(--shadow);
        display:flex;align-items:center;justify-content:center;
    }
    .logo img{width:100%;height:100%;object-fit:cover;}

    h1{margin:0;font-size:18px;font-weight:700}
    .lead{font-size:13px;color:var(--muted);margin:0}

    .layout{display:grid;grid-template-columns:1fr 380px;gap:18px;padding:8px}
    @media(max-width:980px){
        .layout{grid-template-columns:1fr;padding:12px}
    }

    .card{
        background:#fff;padding:14px;border-radius:16px;
        box-shadow:var(--shadow);
    }

    /* Productos */
    .products{
        display:grid;
        grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
        gap:12px;
    }

    .product{border-radius:12px;overflow:hidden;background:#fffefc}
    .product img{width:100%;height:150px;object-fit:cover;}
    .product-body{padding:12px;display:flex;flex-direction:column;gap:8px}
    .product-title{font-weight:700;font-size:15px}
    .price{font-weight:800;color:var(--accent)}

    .btn{padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
    .btn-primary{
        background:linear-gradient(90deg,var(--accent),var(--accent-2));
        color:#fff;
    }
    .btn-ghost{
        background:transparent;border:1px solid #ddd;
    }

    /* Modal */
    #modal{
        position:fixed;left:0;top:0;width:100%;height:100%;
        display:none;align-items:center;justify-content:center;
        padding:18px;z-index:80;
    }

    #modal .sheet{
        width:100%;max-width:760px;
        background:#fff;border-radius:14px;
        padding:14px;box-shadow:var(--shadow);
        max-height:90vh;overflow:auto;
        -webkit-overflow-scrolling:touch;
    }

    #modal img{
        width:140px;height:110px;object-fit:cover;border-radius:8px
    }

    /* --- FIX: modal full-screen en mobile --- */
    @media(max-width:560px){
        #modal .sheet{
            width:100%;height:100%;max-height:none;
            border-radius:0;padding:16px;
        }
        #modal .sheet > div{flex-wrap:wrap;}
        #modal img{
            width:100%;height:auto;max-height:180px;margin-bottom:12px;
        }
    }

    /* Toppings */
    .topping-grid{
        display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;
    }

    .chip{
        padding:8px 10px;border-radius:12px;
        border:1px solid #eee;cursor:pointer;
        background:#fff;
    }
    .chip.active{
        background:linear-gradient(90deg,var(--accent),var(--accent-2));
        color:#fff;border-color:transparent;
    }

    /* Salsas */
    .sauce-list{display:flex;gap:8px;margin-top:8px;}

    /* --- FIX: salsas no se salen en mobile --- */
    @media(max-width:560px){
        .sauce-list{flex-wrap:wrap;}
    }

    .sauce{
        padding:8px 12px;border-radius:12px;
        border:1px solid #eee;cursor:pointer;background:#fff;
    }
    .sauce.active{
        background:var(--accent);color:white;
    }

    /* Carrito */
    .cart{display:flex;flex-direction:column;gap:12px}
    .cart-list{max-height:320px;overflow:auto;padding-right:6px}

    .cart-row{
        display:flex;justify-content:space-between;gap:10px;
        padding:10px 0;border-bottom:1px solid #eee;
    }

    /* Footer fijo */
    .fixed-footer{
        position:fixed;left:0;right:0;bottom:0;
        background:#fff;padding:12px;border-top:1px solid #eee;
        display:flex;justify-content:space-between;align-items:center;
        z-index:90;
    }

    .fixed-total{font-weight:800;font-size:18px}
    .fixed-button{
        background:linear-gradient(90deg,var(--accent),var(--accent-2));
        color:#fff;padding:12px 16px;border-radius:12px;border:0;
        font-weight:800;cursor:pointer;
    }

    /* --- FIX: botón + precio hacen wrap cuando no entra --- */
    @media(max-width:560px){
        .actions-row{
            flex-wrap:wrap;
            width:100%;
        }
        .actions-row button{
            width:100%;
        }
    }

</style>
</head>

<body>

<div class="wrap">
<header>
    <div class="brand">
        <div class="logo">
            <img src="https://i.imgur.com/7eiCAM6.jpeg">
        </div>
        <div>
            <h1>Ice Cream Rolls — Pedidos</h1>
            <p class="lead">Artesanales • Personalizá tu roll • Pedí al instante</p>
        </div>
    </div>
</header>
<div class="layout">

    <!-- Sección de productos -->
    <div class="card">
        <h2>Elegí tus sabores</h2>
        <p class="lead" style="font-size:13px">Podés personalizar cada roll y agregar varios.</p>

        <div style="height:10px"></div>

        <div id="productsArea" class="products"></div>
    </div>


    <!-- Carrito -->
    <div class="card">
        <h2>Tu pedido</h2>

        <div class="cart">
            <div id="cartList" class="cart-list"></div>

            <div class="subtotal-row">
                <div>Total</div>
                <div id="total" style="font-weight:800">$0</div>
            </div>

            <!-- Formulario del cliente -->
            <div style="margin-top:12px">
                <label class="lead" style="font-size:13px">Nombre</label>
                <input id="custName" type="text" placeholder="Tu nombre" style="width:100%;margin-top:4px">

                <label class="lead" style="font-size:13px;margin-top:10px;display:block">Teléfono</label>
                <input id="custPhone" type="text" placeholder="Ej: 3764xxxxxx" style="width:100%;margin-top:4px">

                <label class="lead" style="font-size:13px;margin-top:10px;display:block">Entrega</label>
                <select id="deliveryMode" style="width:100%;margin-top:4px">
                    <option value="pickup">Retiro en local</option>
                    <option value="delivery">Envío a domicilio</option>
                </select>

                <div id="addressBlock" style="display:none;margin-top:8px">
                    <label class="lead" style="font-size:13px">Dirección</label>
                    <input id="custAddress" type="text" placeholder="Calle, número..." style="width:100%;margin-top:4px">
                </div>

                <label class="lead" style="font-size:13px;margin-top:10px;display:block">Método de pago</label>
                <select id="paymentMethod" style="width:100%;margin-top:4px">
                    <option value="cash">Efectivo</option>
                    <option value="transfer">Transferencia</option>
                </select>

                <label class="lead" style="font-size:13px;margin-top:10px;display:block">Notas</label>
                <textarea id="custNotes" rows="2" style="width:100%;margin-top:4px" placeholder="Opcional"></textarea>
            </div>
        </div>
    </div>

</div><!-- END layout -->


</div><!-- END wrap -->


<!-- Footer fijo -->
<div class="fixed-footer">
    <div class="fixed-total">
        Total: <span id="fixedTotal">$0</span>
    </div>
    <button class="fixed-button" id="fixedSendBtn">Enviar pedido</button>
</div>


<!-- Modal -->
<div id="modal">
    <div class="sheet">

        <div style="display:flex;gap:14px;align-items:center;">
            <img id="modalImg" src="">
            <div>
                <h2 id="modalTitle" style="margin:0;font-size:18px;font-weight:700"></h2>
                <div id="modalBasePrice" class="lead" style="font-size:13px"></div>
            </div>
        </div>

        <h3 style="margin-top:18px">Toppings</h3>
        <div id="modalToppings" class="topping-grid"></div>
        <div class="lead" style="font-size:12px;color:#777;margin-top:4px">
            El primer topping es gratis
        </div>

        <h3 style="margin-top:18px">Salsas</h3>
        <div id="modalSauces" class="sauce-list">
            <div class="sauce" data-s="Chocolate">Chocolate</div>
            <div class="sauce" data-s="Dulce de leche">Dulce de leche</div>
            <div class="sauce" data-s="Frutilla">Frutilla</div>
        </div>

        <h3 style="margin-top:18px">Cantidad</h3>
        <input id="modalQty" type="number" min="1" value="1" style="width:120px">

        <!-- FIX aplicado: actions-row -->
        <div class="actions-row" style="display:flex;gap:8px;justify-content:flex-end;margin-top:14px;align-items:center">
            <div id="modalLinePrice" style="font-weight:700;color:var(--accent);">$0</div>
            <button id="addToCartBtn" class="btn btn-primary">Agregar al carrito</button>
            <button class="btn btn-ghost" onclick="closeModal()">Cancelar</button>
        </div>

    </div>
</div>



<!-- ======================= -->
<!--        JAVASCRIPT       -->
<!-- ======================= -->

<script>
/* CONFIG */
const PHONE = "5493764102637";
const BASE_PRICE_DEFAULT = 2500;
const TOPPING_EXTRA_PRICE = 300;

/* Productos (con misma imagen) */
const flavors = [
  { id:"oreo", name:"Oreo", price:2500, img:"https://i.imgur.com/7eiCAM6.jpeg" },
  { id:"choco", name:"Chocolate", price:2500, img:"https://i.imgur.com/7eiCAM6.jpeg" },
  { id:"fruit", name:"Frutilla", price:2500, img:"https://i.imgur.com/7eiCAM6.jpeg" },
  { id:"chocot", name:"Chocotorta", price:2500, img:"https://i.imgur.com/7eiCAM6.jpeg" },
  { id:"tira", name:"Tiramisu", price:2500, img:"https://i.imgur.com/7eiCAM6.jpeg" }
];

const toppings = ["Maní","Chips de colores","Chips de chocolate","Oreo","Rocklets","Coco rallado"];

let cart = [];
let editingItemId = null;
let currentFlavor = null;


/* Helpers */
function $(s){ return document.querySelector(s); }
function $$(s){ return document.querySelectorAll(s); }
function fmt(n){ return "$" + Number(n).toLocaleString("es-AR"); }


/* Render productos */
function renderProducts(){
    const area = $("#productsArea");
    area.innerHTML = "";
    flavors.forEach(f=>{
        const box = document.createElement("div");
        box.className = "product";
        box.innerHTML = `
            <img src="${f.img}">
            <div class="product-body">
                <div class="product-title">${f.name}</div>
                <div class="product-foot" style="display:flex;justify-content:space-between;align-items:center;margin-top:6px">
                    <div class="price">${fmt(f.price)}</div>
                    <button class="btn btn-primary" onclick="openModal('${f.id}','${f.name}')">Armar</button>
                </div>
            </div>
        `;
        area.appendChild(box);
    });
}


/* Modal */
function openModal(id,name){
    editingItemId = null;
    currentFlavor = flavors.find(f=>f.id===id);

    $("#modalTitle").textContent = name;
    $("#modalImg").src = currentFlavor.img;
    $("#modalBasePrice").textContent = "Base: " + fmt(currentFlavor.price);
    $("#modalQty").value = 1;

    // toppings
    const t = $("#modalToppings");
    t.innerHTML = "";
    toppings.forEach(tp=>{
        const el = document.createElement("label");
        el.className="chip";
        el.innerHTML = `<input type="checkbox" value="${tp}"> ${tp}`;
        el.querySelector("input").addEventListener("change", updateModalPrice);
        t.appendChild(el);
    });

    // sauces
    $("#modalSauces").querySelectorAll(".sauce").forEach(s=>{
        s.classList.remove("active");
        s.onclick = ()=>{
            $("#modalSauces").querySelectorAll(".sauce").forEach(x=>x.classList.remove("active"));
            s.classList.add("active");
            updateModalPrice();
        }
    });

    updateModalPrice();

    $("#modal").style.display="flex";
    document.body.style.overflow="hidden";
}

function closeModal(){
    $("#modal").style.display="none";
    document.body.style.overflow="auto";
}

function updateModalPrice(){
    const qty = Math.max(1, parseInt($("#modalQty").value||"1"));
    const checked = [...$("#modalToppings").querySelectorAll("input:checked")].map(i=>i.value);
    const extra = Math.max(0, checked.length-1) * TOPPING_EXTRA_PRICE;
    $("#modalLinePrice").textContent = fmt((currentFlavor.price+extra)*qty);
}


/* Add to cart */
$("#addToCartBtn").onclick = ()=>{
    const qty = Math.max(1, parseInt($("#modalQty").value||"1"));
    const selectedToppings = [...$("#modalToppings").querySelectorAll("input:checked")].map(i=>i.value);
    const sauceEl = $("#modalSauces").querySelector(".sauce.active");
    const sauce = sauceEl ? sauceEl.dataset.s : "";

    const extraPerUnit = Math.max(0, selectedToppings.length-1) * TOPPING_EXTRA_PRICE;
    const itemTotal = (currentFlavor.price + extraPerUnit) * qty;

    if(editingItemId){
        const it = cart.find(x=>x.id===editingItemId);
        it.qty = qty;
        it.toppings = selectedToppings;
        it.sauce = sauce;
        it.unitPrice = currentFlavor.price;
    } else {
        cart.push({
            id:"i"+Date.now(),
            flavorName: currentFlavor.name,
            flavorId: currentFlavor.id,
            qty: qty,
            toppings: selectedToppings,
            sauce: sauce,
            unitPrice: currentFlavor.price
        });
    }

    closeModal();
    renderCart();
};


/* Render cart */
function calcItemTotal(it){
    const extra = Math.max(0, it.toppings.length-1)*TOPPING_EXTRA_PRICE;
    return (it.unitPrice+extra)*it.qty;
}

function renderCart(){
    const list = $("#cartList");
    list.innerHTML = "";

    let total = 0;

    cart.forEach(it=>{
        total += calcItemTotal(it);

        const row = document.createElement("div");
        row.className="cart-row";
        row.innerHTML = `
            <div>
                <b>${it.qty}× ${it.flavorName}</b><br>
                <span class="small">${it.toppings.join(", ") || "Sin toppings"} • ${it.sauce || "Sin salsa"}</span>
            </div>
            <div style="text-align:right">
                <b>${fmt(calcItemTotal(it))}</b><br>
                <button class="btn btn-ghost" style="margin-top:6px;font-size:12px" onclick="editItem('${it.id}')">Editar</button>
                <button class="btn btn-ghost" style="margin-top:6px;font-size:12px" onclick="removeItem('${it.id}')">Eliminar</button>
            </div>
        `;
        list.appendChild(row);
    });

    $("#total").textContent = fmt(total);
    $("#fixedTotal").textContent = fmt(total);
}

function editItem(id){
    editingItemId = id;
    const it = cart.find(x=>x.id===id);
    openModal(it.flavorId, it.flavorName);

    $("#modalQty").value = it.qty;

    // toppings
    $("#modalToppings").querySelectorAll("input").forEach(ch=>{
        if(it.toppings.includes(ch.value)) ch.checked = true;
    });

    // sauce
    $("#modalSauces").querySelectorAll(".sauce").forEach(s=>{
        if(s.dataset.s === it.sauce) s.classList.add("active");
    });

    updateModalPrice();
}

function removeItem(id){
    cart = cart.filter(x=>x.id!==id);
    renderCart();
}

/* Delivery select */
$("#deliveryMode").onchange = ()=>{
    $("#addressBlock").style.display = ($("#deliveryMode").value==="delivery") ? "block":"none";
};

/* WhatsApp */
function sendWhatsApp(){
    if(cart.length===0){
        alert("Tu carrito está vacío.");
        return;
    }

    let name = $("#custName").value.trim();
    let phone = $("#custPhone").value.trim();
    if(!name){ alert("Ingresá tu nombre."); return; }
    if(!phone){ alert("Ingresá tu teléfono."); return; }

    let mode = $("#deliveryMode").value;
    let address = $("#custAddress").value.trim();

    if(mode==="delivery" && !address){
        alert("Ingresá la dirección.");
        return;
    }

    let pay = $("#paymentMethod").value;
    let notes = $("#custNotes").value.trim();

    let msg = "Nuevo pedido%0A%0A";

    cart.forEach((it,i)=>{
        msg += `${i+1}) ${it.qty}× ${it.flavorName}%0A`;
        msg += `Toppings: ${it.toppings.join(", ") || "Sin toppings"}%0A`;
        msg += `Salsa: ${it.sauce || "Sin salsa"}%0A`;
        msg += `Subtotal: ${fmt(calcItemTotal(it))}%0A%0A`;
    });

    msg += `Total: ${$("#total").textContent}%0A%0A`;
    msg += `Cliente: ${name}%0A`;
    msg += `Tel: ${phone}%0A`;
    msg += `Entrega: ${mode==="pickup"?"Retiro":"Envío"}%0A`;
    if(mode==="delivery") msg += `Dirección: ${address}%0A`;
    msg += `Pago: ${pay==="cash"?"Efectivo":"Transferencia"}%0A`;
    if(notes) msg += `Notas: ${notes}%0A`;

    window.open(`https://wa.me/${PHONE}?text=${msg}`,"_blank");
}

$("#fixedSendBtn").onclick = sendWhatsApp;


/* INIT */
renderProducts();
renderCart();

</script>

</body>
</html>

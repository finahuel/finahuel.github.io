<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Ice Cream Rolls — Pedidos</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --bg: #e7f6fa;
        --accent: #f46da0;
        --accent-2: #ffd66b;
        --card: #ffffff;
        --muted: #6b6b6b;
        --shadow: 0 10px 30px rgba(12, 12, 12, 0.06);
      }

      /* ============================
   RESET Y CONTENEDOR PRINCIPAL
============================= */
      * {
        box-sizing: border-box;
        max-width: 100%;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        overflow-x: hidden;
        scroll-behavior: smooth;
      }

      body {
        font-family: Inter, system-ui, "Helvetica Neue", Arial;
        background: linear-gradient(180deg, var(--bg) 0%, #ffffff 120%);
        -webkit-font-smoothing: antialiased;
      }

      img {
        display: block;
      }

      .wrap {
        max-width: 980px;
        margin: 0 auto;
        padding: 18px;
      }
      header {
        display: flex;
        align-items: center;
        gap: 14px;
        padding: 10px 6px;
      }
      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
        width: 100%;
      }
      .logo {
        width: 72px;
        height: 72px;
        border-radius: 14px;
        flex: 0 0 72px;
        overflow: hidden;
        box-shadow: var(--shadow);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .logo img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      h1 {
        margin: 0;
        font-size: 18px;
        font-weight: 700;
      }
      .lead {
        font-size: 13px;
        color: var(--muted);
        margin: 0;
      }

      /* GRID layout: columna principal flexible + sidebar hasta 380px */
      .layout {
        display: grid;
        grid-template-columns: minmax(0, 1fr) minmax(0, 380px);
        gap: 18px;
        padding: 8px;
        align-items: start;
      }
      /* permitir que los hijos encogan (evita que un min-width interno rompa la grid) */
      .layout > * {
        min-width: 0;
      }

      /* Card */
      .card {
        background: #fff;
        padding: 14px;
        border-radius: 16px;
        box-shadow: var(--shadow);
      }

      /* Productos (grilla interna) */
      .products {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 12px;
        min-width: 0;
      }

      .product {
        border-radius: 12px;
        overflow: hidden;
        background: #fffefc;
        display: flex;
        flex-direction: column;
      }
      .product img {
        display: block;
        width: 100%;
        height: 150px;
        object-fit: cover;
        background: #f7f7f7;
        min-width: 0;
      }
      .product-body {
        padding: 12px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        flex: 1;
      }
      .product-title {
        font-weight: 700;
        font-size: 15px;
      }
      .price {
        font-weight: 800;
        color: var(--accent);
      }

      /* Buttons */
      .btn {
        padding: 8px 12px;
        border-radius: 10px;
        border: 0;
        cursor: pointer;
        font-weight: 700;
      }
      .btn-primary {
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        color: #fff;
      }
      .btn-ghost {
        background: transparent;
        border: 1px solid #ddd;
      }

      /* Modal */
      #modal {
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 18px;
        z-index: 120;
      }
      #modal .sheet {
        width: 100%;
        max-width: 760px;
        background: #fff;
        border-radius: 14px;
        padding: 14px;
        box-shadow: var(--shadow);
        max-height: 90vh;
        overflow: auto;
        -webkit-overflow-scrolling: touch;
      }
      #modal img {
        width: 140px;
        height: 110px;
        object-fit: cover;
        border-radius: 8px;
      }

      /* Toppings / sauces */
      .topping-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 8px;
      }
      .chip {
        padding: 8px 10px;
        border-radius: 12px;
        border: 1px solid #eee;
        cursor: pointer;
        background: #fff;
      }
      .chip.active {
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        color: #fff;
        border-color: transparent;
      }
      .sauce-list {
        display: flex;
        gap: 8px;
        margin-top: 8px;
      }
      .sauce {
        padding: 8px 12px;
        border-radius: 12px;
        border: 1px solid #eee;
        cursor: pointer;
        background: #fff;
      }
      .sauce.active {
        background: var(--accent);
        color: white;
      }

      /* Carrito */
      .cart {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .cart-list {
        max-height: 320px;
        overflow: auto;
        padding-right: 6px;
      }
      .cart-row {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        padding: 10px 0;
        border-bottom: 1px solid #eee;
      }

      /* Footer fijo */
      .fixed-footer {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        background: #fff;
        padding: 12px;
        border-top: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 200;
        box-shadow: 0 -6px 18px rgba(12, 12, 12, 0.06);
      }
      .fixed-total {
        font-weight: 800;
        font-size: 18px;
      }
      .fixed-button {
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        color: #fff;
        padding: 12px 16px;
        border-radius: 12px;
        border: 0;
        font-weight: 800;
        cursor: pointer;
      }

      /* Actions row: responsive adjustments */
      @media (max-width: 560px) {
        .actions-row {
          flex-wrap: wrap;
          width: 100%;
        }
        .actions-row button {
          width: 100%;
        }
      }

      /* PAYMENT & FORM styling small */
      .payment-msg {
        font-size: 12px;
        color: var(--accent);
        margin-top: 4px;
        display: none;
      }

      /* nice form */
      .nice-form {
        display: flex;
        flex-direction: column;
        gap: 14px;
      }
      .form-field {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .nice-form input,
      .nice-form select,
      .nice-form textarea {
        width: 100%;
        padding: 10px;
        border-radius: 10px;
        border: 1px solid #e2e2e2;
        font-size: 14px;
        background: #fff;
        box-shadow: inset 0 0 0 transparent;
        transition: border 0.2s ease, box-shadow 0.2s ease;
      }
      .nice-form input:focus,
      .nice-form select:focus,
      .nice-form textarea:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(244, 109, 160, 0.12);
        outline: none;
      }

      /* ===========================
        Responsive tweaks
        =========================== */

      /* For mobile and small tablets force single column and ensure children can shrink */
      @media (max-width: 980px) {
        .layout {
          grid-template-columns: minmax(0, 1fr) !important;
          gap: 12px;
          padding: 12px;
        }
        .layout > * {
          width: 100%;
          min-width: 0 !important;
        }
        .products {
          grid-template-columns: repeat(
            auto-fit,
            minmax(120px, 1fr)
          ) !important;
          gap: 10px;
        }
        .product img {
          height: 110px !important;
        }
        header .brand {
          flex-wrap: wrap;
        }
        body {
          padding-bottom: 120px;
        } /* más espacio para footer en móvil */
      }

      /* very small phones */
      @media (max-width: 420px) {
        .product img {
          height: 100px !important;
        }
        .wrap {
          padding: 10px;
        }
        .card {
          padding: 12px;
          border-radius: 12px;
        }
      }

      /* final safety: prevent global overflow horizontal */
      html,
      body,
      .wrap,
      .layout,
      .products,
      .card {
        min-width: 0;
      }

      /* ============================
   BOTONES DE PRODUCTO - CORREGIDO
============================= */
      /* Contenedor principal del pie del producto */
      .product-foot {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 10px;
        width: 100%;
      }

      /* Precio alineado a la izquierda */
      .product-foot .price {
        flex: 0 0 auto;
        white-space: nowrap;
        font-weight: 800;
        color: var(--accent);
      }

      /* Botón "Armar" alineado a la derecha */
      .product .btn-primary {
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        border: none;
        font-weight: 700;
        padding: 8px 16px;
        border-radius: 10px;
        color: white;
        cursor: pointer;
        white-space: nowrap;
        min-width: 70px;
        margin: 0; /* Asegurar que no tenga márgenes */
      }

      /* En móviles */
      @media (max-width: 520px) {
        .product-foot {
          flex-direction: column;
          align-items: stretch;
          gap: 8px;
        }

        .product-foot .price {
          text-align: center;
          margin-bottom: 4px;
        }

        .product .btn-primary {
          width: 100%;
          text-align: center;
        }
      }

      /* ============================
   HERO SECTION CORREGIDO
============================= */
      .hero--full {
        width: 100vw;
        height: 100vh; /* Ocupa toda la pantalla */
        min-height: 600px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #fff0f6 0%, #e7f6fa 100%);
        position: relative;
        overflow: hidden;
      }

      .hero-inner {
        width: 100%;
        max-width: 1200px;
        padding: 0 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        gap: 30px;
      }

      .hero-media {
        width: 100%;
        max-width: 800px;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .hero-media img {
        width: 100%;
        max-width: 600px;
        height: auto;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        object-fit: cover;
      }

      .hero-cta {
        width: 100%;
        display: flex;
        justify-content: center;
        margin-top: 20px;
      }

      .hero-btn {
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        color: white;
        padding: 16px 32px;
        border-radius: 14px;
        border: none;
        font-weight: 700;
        font-size: 18px;
        cursor: pointer;
        box-shadow: 0 8px 24px rgba(244, 109, 160, 0.3);
        transition: all 0.3s ease;
        min-width: 200px;
      }

      .hero-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 28px rgba(244, 109, 160, 0.4);
      }

      /* ============================
   NAVBAR FIJO (ACTUALIZADO)
============================= */
      .navbar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 64px;
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        z-index: 1000;
        display: flex;
        align-items: center;
        padding: 0 20px;
      }

      .nav-inner {
        max-width: 1200px;
        width: 100%;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .nav-brand {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .nav-brand img {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        object-fit: cover;
      }

      .nav-text {
        display: flex;
        flex-direction: column;
        line-height: 1.2;
      }

      .nav-text strong {
        font-size: 16px;
        font-weight: 700;
        color: #333;
      }

      .nav-text span {
        font-size: 12px;
        color: var(--muted);
      }

      .nav-actions {
        display: flex;
        gap: 10px;
      }

      .nav-btn {
        padding: 8px 16px;
        border-radius: 10px;
        border: 1px solid #e2e2e2;
        background: #fff;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .nav-btn:hover {
        background: #f5f5f5;
        transform: translateY(-1px);
      }

      /* Compensar navbar fijo */
      body {
        padding-top: 64px;
      }

      /* ============================
        SCROLL SNAPPING CORREGIDO - MÓVILES
        ============================= */

      /* EN MÓVILES (max-width: 980px) */
      @media (max-width: 980px) {
        /* Eliminar scroll snapping problemático */
        .snap-container {
          height: auto;
          overflow-y: auto;
          overflow-x: hidden;
          scroll-behavior: smooth;
          -webkit-overflow-scrolling: touch;
        }

        .snap-section {
          height: 100vh;
          min-height: 100vh;
        }

        .hero--full {
          height: 100vh;
          min-height: 100vh;
        }

        /* Ajustar para navbar fijo */
        .hero--full {
          scroll-margin-top: 64px;
        }

        /* Mejorar el scroll general */
        body {
          overflow-y: auto;
          height: auto;
        }
      }

      /* EN PC (min-width: 981px) - SIN SCROLL SNAPPING */
      @media (min-width: 981px) {
        .snap-container {
          height: auto;
          overflow-y: visible;
          position: relative;
        }

        .snap-section {
          height: auto;
        }

        .hero--full {
          height: 100vh;
          min-height: 100vh;
        }

        /* Scrollbar visible en PC */
        body {
          scrollbar-width: thin;
          scrollbar-color: var(--accent) #f0f0f0;
        }

        body::-webkit-scrollbar {
          display: block;
          width: 10px;
        }

        body::-webkit-scrollbar-track {
          background: #f0f0f0;
          border-radius: 5px;
          margin: 5px 0;
        }

        body::-webkit-scrollbar-thumb {
          background: linear-gradient(180deg, var(--accent), var(--accent-2));
          border-radius: 5px;
          border: 2px solid #f0f0f0;
        }

        body::-webkit-scrollbar-thumb:hover {
          background: linear-gradient(180deg, var(--accent-2), var(--accent));
        }
      }

      /* ============================
        FOOTER FIJO CONDICIONAL
        ============================= */
      .fixed-footer {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        background: #fff;
        padding: 12px;
        border-top: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 200;
        box-shadow: 0 -6px 18px rgba(12, 12, 12, 0.06);
        transform: translateY(100%); /* Oculto por defecto */
        transition: transform 0.3s ease;
      }

      .fixed-footer.visible {
        transform: translateY(0); /* Mostrar */
      }

      .fixed-total {
        font-weight: 800;
        font-size: 18px;
      }

      .fixed-button {
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        color: #fff;
        padding: 12px 16px;
        border-radius: 12px;
        border: 0;
        font-weight: 800;
        cursor: pointer;
      }

      /* Ajustar espacio en body cuando footer está visible */
      body.footer-visible {
        padding-bottom: 70px;
      }

      /* ============================
        RESPONSIVE MEJORADO
        ============================= */
      @media (max-width: 768px) {
        .hero--full {
          min-height: 500px;
          height: 100vh;
          height: -webkit-fill-available; /* Para navegadores móviles */
        }

        .hero-inner {
          padding: 0 15px;
          gap: 20px;
        }

        .hero-media img {
          max-width: 90%;
          border-radius: 15px;
          max-height: 50vh;
        }

        .hero-btn {
          padding: 14px 28px;
          font-size: 16px;
          min-width: 180px;
        }

        .nav-btn {
          padding: 6px 12px;
          font-size: 13px;
        }

        /* Mejorar scroll en móviles */
        .snap-container {
          overflow-y: auto;
          height: auto;
        }
        
        /* Permitir scroll normal en body */
        body, html {
          overflow-y: auto;
          height: auto;
        }
      }

      @media (max-width: 480px) {
        .hero--full {
          min-height: 400px;
        }

        .hero-btn {
          padding: 12px 24px;
          font-size: 15px;
          min-width: 160px;
        }

        .hero-media img {
          max-width: 95%;
          max-height: 40vh;
        }

        .fixed-footer {
          padding: 10px;
          flex-wrap: wrap;
          gap: 8px;
        }

        .fixed-footer .footer-left {
          width: 100%;
          justify-content: center;
          margin-bottom: 5px;
        }

        .fixed-footer .footer-actions {
          width: 100%;
          justify-content: space-between;
        }

        /* Ajustar botones del footer en móviles */
        .fixed-footer .btn-ghost {
          padding: 6px 8px;
          font-size: 12px;
        }

        .fixed-button {
          padding: 8px 12px;
          font-size: 14px;
        }
      }

      /* Para tablets en orientación horizontal */
      @media (max-width: 1024px) and (orientation: landscape) {
        .hero--full {
          min-height: 400px;
        }

        .hero-media img {
          max-width: 60%;
          max-height: 60vh;
        }
      }

      /* ============================
        MEJORAS ESTÉTICAS
        ============================= */

      /* Mejorar contenedor principal */
      .layout {
        margin-top: 20px;
        padding: 0 8px;
      }

      /* Mejorar tarjetas de productos */
      .product {
        border: 1px solid rgba(0, 0, 0, 0.05);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .product:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.08);
      }

      /* Asegurar que los botones "Armar" se vean bien */
      .product .btn-primary {
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        border: none;
        font-weight: 700;
        letter-spacing: 0.3px;
        min-width: 70px;
      }

      /* Mejorar el formulario */
      .nice-form {
        background: #fdfdfd;
        border-radius: 16px;
        padding: 20px;
      }

      .nice-form h3 {
        color: #333;
        margin-bottom: 16px;
        font-size: 18px;
      }

      /* Mejorar el carrito */
      .cart-row {
        padding: 14px 0;
        border-bottom: 1px solid #f0f0f0;
      }

      .cart-row:last-child {
        border-bottom: none;
      }

      /* Mejorar los botones de editar/eliminar */
      .cart-row .btn-ghost {
        font-size: 12px;
        padding: 5px 10px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
      }

      /* Asegurar que el grid de productos se vea bien en todos los dispositivos */
      @media (max-width: 768px) {
        .products {
          grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
          gap: 12px;
        }
      }

      @media (max-width: 480px) {
        .products {
          grid-template-columns: repeat(2, 1fr);
          gap: 10px;
        }

        .product img {
          height: 120px !important;
        }
      }

      /* Efecto de pulso para el botón del hero */
      @keyframes pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(244, 109, 160, 0.7);
        }
        70% {
          box-shadow: 0 0 0 10px rgba(244, 109, 160, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(244, 109, 160, 0);
        }
      }

      .hero-btn {
        animation: pulse 2s infinite;
      }

      .hero-btn:hover {
        animation: none; /* Detener animación al hover */
      }

      /* ============================
   MODAL MEJORADO - NO TAPADO POR FOOTER
============================= */

      #modal {
        z-index: 2000; /* Mayor que footer (200) y navbar (1000) */
        background-color: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(5px);
      }

      /* Modal responsivo para móviles */
      @media (max-width: 768px) {
        #modal {
          padding: 20px 10px;
          align-items: center; /* Centrado vertical */
          justify-content: center; /* Centrado horizontal */
        }

        #modal .sheet {
          width: 95%;
          max-width: 500px;
          max-height: 85vh;
          border-radius: 16px;
          margin: 0 auto;
          position: relative;
          overflow-y: auto;
          -webkit-overflow-scrolling: touch;
          box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        }

        /* Si el footer está visible, dejar espacio */
        body.footer-visible #modal {
          padding-bottom: 100px; /* Espacio extra para el footer */
        }

        #modal img {
          width: 100px;
          height: 80px;
        }

        /* Asegurar que los toppings sean desplazables en móviles */
        .topping-grid {
          max-height: 150px;
          overflow-y: auto;
          padding-right: 5px;
        }

        .chip {
          padding: 8px 12px;
          font-size: 14px;
        }

        /* Botones fijos en la parte inferior del modal */
        .actions-row {
          position: sticky;
          bottom: 0;
          background: white;
          padding: 15px 0 5px;
          border-top: 1px solid #eee;
          margin-top: 20px;
          z-index: 10;
        }

        #addToCartBtn,
        .actions-row .btn-ghost {
          padding: 12px;
          font-size: 16px;
        }
      }

      /* Móviles muy pequeños */
      @media (max-width: 480px) {
        #modal .sheet {
          width: 98%;
          max-height: 90vh;
          padding: 15px;
        }

        #modal img {
          width: 70px;
          height: 60px;
        }

        .chip {
          padding: 6px 10px;
          font-size: 13px;
        }

        .sauce {
          padding: 8px 10px;
          font-size: 14px;
        }

        #modalQty {
          width: 100px;
          padding: 8px;
        }
      }

      /* ============================
        MEJORAS FINALES DE LAYOUT
        ============================= */

      /* Asegurar que el layout se comporte bien */
      .layout {
        min-height: auto;
        align-items: stretch;
      }

      /* Asegurar que las columnas tengan el mismo alto */
      .layout > .card:first-child {
        display: flex;
        flex-direction: column;
      }

      /* La sección de productos debe crecer */
      #productsArea {
        flex: 1;
      }

      /* Ajustes para pantallas grandes */
      @media (min-width: 981px) {
        .layout {
          grid-template-columns: 1fr 380px;
          align-items: start;
        }

        .sidebar {
          position: sticky;
          top: 84px; /* Navbar height + padding */
          max-height: calc(100vh - 100px);
          overflow-y: auto;
        }
      }

      /* Permitir scroll en el sidebar */
      .sidebar {
        overflow-y: auto;
      }
    </style>
  </head>

  <body>
    <div class="snap-container">
      <!-- ===================================== -->
      <!-- HERO PRINCIPAL                        -->
      <!-- ===================================== -->
      <section class="hero hero--full snap-section">
        <div class="hero-inner">
          <div class="hero-media">
            <img src="img/home.png" alt="Helado Tailandés" />
          </div>

          <div class="hero-cta">
            <button
              class="hero-btn"
              onclick="scrollToProducts()"
              aria-label="Hacer pedido"
            >
              Hacer pedido
            </button>
          </div>
        </div>
      </section>

      <div class="wrap">
        <header class="navbar">
          <div class="nav-inner">
            <div class="nav-brand">
              <img src="img/logo.jpeg" alt="Thai Cream" />
              <div class="nav-text">
                <strong>Thai Cream</strong>
                <span>Posadas</span>
              </div>
            </div>

            <nav class="nav-actions">
              <button class="nav-btn" onclick="scrollToProducts()">Menú</button>
              <button class="nav-btn" onclick="scrollToCart()">Pedido</button>
            </nav>
          </div>
        </header>

        <div id="productsStart"></div>

        <section class="layout">
          <!-- COLUMNA IZQUIERDA: productos -->
          <div class="card">
            <h2>Elegí tus sabores</h2>
            <p class="lead" style="font-size: 13px">
              Podés personalizar cada roll y agregar varios.
            </p>

            <div style="height: 10px"></div>

            <div id="productsArea" class="products"></div>
          </div>

          <!-- COLUMNA DERECHA: sidebar que contiene carrito + formulario -->
          <div class="sidebar">
            <!-- PANEL: Resumen / carrito -->
            <div class="card" style="margin-bottom: 12px">
              <h3 style="margin: 0 0 8px 0">Tu pedido</h3>
              <div id="cartList" class="cart-list">
                <div class="small" style="color: var(--muted)">
                  No hay items todavía
                </div>
              </div>

              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-top: 12px;
                "
              >
                <div>
                  <div class="small">Subtotal</div>
                  <div id="total" style="font-weight: 800">$0</div>
                </div>
              </div>
            </div>

            <!-- FORMULARIO (debajo del carrito) -->
            <div class="card nice-form">
              <h3 style="margin-top: 0">Datos del cliente</h3>

              <div class="form-field">
                <label>Nombre</label>
                <input id="custName" type="text" placeholder="Tu nombre" />
              </div>

              <div class="form-field">
                <label>Teléfono</label>
                <input id="custPhone" type="tel" placeholder="Ej: 3764xxxxxx" />
              </div>

              <div class="form-field">
                <label>Retiro o Entrega</label>
                <select id="deliveryMode">
                  <option value="pickup">Retiro en local</option>
                  <option value="delivery">Envío a domicilio</option>
                </select>
              </div>

              <div id="addressBlock" class="form-field" style="display: none">
                <label>Dirección</label>
                <input
                  id="custAddress"
                  type="text"
                  placeholder="Calle, número..."
                />
              </div>

              <div class="form-field">
                <label>Método de pago</label>
                <select id="paymentMethod">
                  <option value="cash">Efectivo</option>
                  <option value="transfer">Transferencia</option>
                </select>

                <div id="paymentNotice" class="payment-msg">
                  Para envíos solo aceptamos transferencia.
                </div>
              </div>

              <div class="form-field">
                <label>Notas (opcional)</label>
                <textarea
                  id="custNotes"
                  rows="2"
                  placeholder="Ej: sin azúcar / venir a tal hora"
                ></textarea>
              </div>

              <button
                id="checkoutBtn2"
                class="btn btn-primary"
                style="width: 100%; margin-top: 10px"
              >
                Enviar pedido
              </button>
            </div>
          </div>
          <!-- FIN SIDEBAR -->
        </section>
        <!-- END layout -->
      </div>
      <!-- END wrap -->
    </div>
    <!-- END snap-container -->

    <!-- Footer fijo mejorado -->
    <div class="fixed-footer" id="fixedFooter">
      <div
        class="footer-left"
        style="display: flex; align-items: center; gap: 12px"
      >
        <div style="font-weight: 800; font-size: 16px">
          Total: <span id="fixedTotal">$0</span>
        </div>
      </div>

      <div
        class="footer-actions"
        style="display: flex; gap: 8px; align-items: center"
      >
        <button
          id="footerAddBtn"
          class="btn btn-ghost"
          title="Agregar otro roll"
          style="padding: 8px 10px"
        >
          Menú
        </button>
        <button
          id="footerFormBtn"
          class="btn btn-ghost"
          title="Completar datos"
          style="padding: 8px 10px"
        >
          Cliente
        </button>
        <button
          id="footerClearBtn"
          class="btn btn-ghost"
          title="Vaciar carrito"
          style="padding: 8px 10px"
        >
          Vaciar
        </button>
        <button
          id="fixedSendBtn"
          class="fixed-button"
          style="padding: 10px 14px"
        >
          Enviar pedido
        </button>
      </div>
    </div>

    <!-- Modal -->
    <div id="modal">
      <div class="sheet">
        <div style="display: flex; gap: 14px; align-items: center">
          <img id="modalImg" src="" />
          <div>
            <h2
              id="modalTitle"
              style="margin: 0; font-size: 18px; font-weight: 700"
            ></h2>
            <div id="modalBasePrice" class="lead" style="font-size: 13px"></div>
          </div>
        </div>

        <h3 style="margin-top: 18px">Toppings</h3>
        <div id="modalToppings" class="topping-grid"></div>
        <div class="lead" style="font-size: 12px; color: #777; margin-top: 4px">
          El primer topping es gratis
        </div>

        <h3 style="margin-top: 18px">Salsas</h3>
        <div id="modalSauces" class="sauce-list">
          <div class="sauce" data-s="Chocolate">Chocolate</div>
          <div class="sauce" data-s="Dulce de leche">Dulce de leche</div>
          <div class="sauce" data-s="Frutilla">Frutilla</div>
        </div>

        <h3 style="margin-top: 18px">Cantidad</h3>
        <input
          id="modalQty"
          type="number"
          min="1"
          value="1"
          style="width: 120px"
        />

        <!-- FIX aplicado: actions-row -->
        <div
          class="actions-row"
          style="
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 14px;
            align-items: center;
          "
        >
          <div
            id="modalLinePrice"
            style="font-weight: 700; color: var(--accent)"
          >
            $0
          </div>
          <button id="addToCartBtn" class="btn btn-primary">
            Agregar al carrito
          </button>
          <button class="btn btn-ghost" onclick="closeModal()">Cancelar</button>
        </div>
      </div>
    </div>

    <!-- ======================= -->
    <!--        JAVASCRIPT       -->
    <!-- ======================= -->

    <script>
      /* CONFIG */
      const PHONE = "5493764102637";
      const BASE_PRICE_DEFAULT = 2500;
      const TOPPING_EXTRA_PRICE = 300;

      /* Productos (con misma imagen) */
      const flavors = [
        { id: "oreo", name: "Oreo", price: 2500, img: "img/oreo.jpeg" },
        { id: "choco", name: "Chocolate", price: 2500, img: "img/oreo.jpeg" },
        { id: "fruit", name: "Frutilla", price: 2500, img: "img/oreo.jpeg" },
        { id: "chocot", name: "Chocotorta", price: 2500, img: "img/oreo.jpeg" },
        { id: "tira", name: "Tiramisu", price: 2500, img: "img/oreo.jpeg" },
      ];

      const toppings = [
        "Maní",
        "Chips de colores",
        "Chips de chocolate",
        "Oreo",
        "Rocklets",
        "Coco rallado",
      ];

      let cart = [];
      let editingItemId = null;
      let currentFlavor = null;
      let isSubmitting = false; // Variable para evitar doble envío

      /* Helpers */
      function $(s) {
        return document.querySelector(s);
      }
      function $$(s) {
        return document.querySelectorAll(s);
      }
      function fmt(n) {
        return "$" + Number(n).toLocaleString("es-AR");
      }

      /* Función simple: mostrar footer solo si hay productos */
      function updateFooter() {
        const footer = document.getElementById("fixedFooter");
        const body = document.body;

        if (!footer) return;

        if (cart.length > 0) {
          footer.classList.add("visible");
          body.classList.add("footer-visible");
        } else {
          footer.classList.remove("visible");
          body.classList.remove("footer-visible");
        }
      }

      /* Configuración SIMPLIFICADA del sistema de scroll */
      function initScrollSystem() {
        const isMobile = window.innerWidth <= 980;
        const snapContainer = document.querySelector(".snap-container");

        if (!snapContainer) return;

        if (isMobile) {
          // En móvil: sin scroll snapping problemático
          snapContainer.style.scrollSnapType = "none";
          snapContainer.style.overflowY = "auto";
          snapContainer.style.height = "auto";
          document.body.style.overflow = "auto";
          document.body.style.height = "auto";
          
          // Asegurar que el hero no interfiera con el scroll
          const hero = document.querySelector('.hero--full');
          if (hero) {
            hero.style.position = 'relative';
          }
        } else {
          // En PC: scroll normal, sin snapping
          snapContainer.style.scrollSnapType = "none";
          snapContainer.style.overflowY = "visible";
          snapContainer.style.height = "auto";
          document.body.style.overflow = "auto";
        }
      }

      /* Render productos */
      function renderProducts() {
        const area = $("#productsArea");
        area.innerHTML = "";
        flavors.forEach((f) => {
          const box = document.createElement("div");
          box.className = "product";
          box.innerHTML = `
            <img src="${
              f.img
            }" onerror="this.onerror=null;this.src='https://via.placeholder.com/400x300?text=Ice+Cream'">
            <div class="product-body">
                <div class="product-title">${f.name}</div>
                <div class="product-foot">
                    <div class="price">${fmt(f.price)}</div>
                    <button class="btn btn-primary" onclick="startNewModal('${
                      f.id
                    }','${f.name}')">Armar</button>
                </div>
            </div>
        `;
          area.appendChild(box);
        });
      }

      // Helper: abrir modal para CREAR un nuevo ítem (limpia editingItemId)
      function startNewModal(id, name) {
        editingItemId = null; // declaramos que es un nuevo ítem
        openModal(id, name);
      }

      // Modal para personalizar (NO resetea editingItemId — así permite editar correctamente)
      function openModal(id, name) {
        // NO hacemos editingItemId = null aquí (importante)
        currentFlavor = flavors.find((f) => f.id === id);

        $("#modalTitle").textContent = name;
        $("#modalImg").src = currentFlavor.img;
        $("#modalBasePrice").textContent = "Base: " + fmt(currentFlavor.price);
        $("#modalQty").value = 1;

        // toppings
        const t = $("#modalToppings");
        t.innerHTML = "";
        toppings.forEach((tp) => {
          const el = document.createElement("label");
          el.className = "chip";
          el.innerHTML = `<input type="checkbox" value="${tp}"> ${tp}`;
          el.querySelector("input").addEventListener(
            "change",
            updateModalPrice
          );
          t.appendChild(el);
        });

        // sauces
        $("#modalSauces")
          .querySelectorAll(".sauce")
          .forEach((s) => {
            s.classList.remove("active");
            s.onclick = () => {
              $("#modalSauces")
                .querySelectorAll(".sauce")
                .forEach((x) => x.classList.remove("active"));
              s.classList.add("active");
              updateModalPrice();
            };
          });

        updateModalPrice();

        $("#modal").style.display = "flex";
        document.body.style.overflow = "hidden";
      }

      function closeModal() {
        $("#modal").style.display = "none";
        document.body.style.overflow = "auto";
      }

      function updateModalPrice() {
        const qty = Math.max(1, parseInt($("#modalQty").value || "1"));
        const checked = [
          ...$("#modalToppings").querySelectorAll("input:checked"),
        ].map((i) => i.value);
        const extra = Math.max(0, checked.length - 1) * TOPPING_EXTRA_PRICE;
        $("#modalLinePrice").textContent = fmt(
          (currentFlavor.price + extra) * qty
        );
      }

      /* Add to cart */
      $("#addToCartBtn").onclick = () => {
        const qty = Math.max(1, parseInt($("#modalQty").value || "1"));
        const selectedToppings = [
          ...$("#modalToppings").querySelectorAll("input:checked"),
        ].map((i) => i.value);
        const sauceEl = $("#modalSauces").querySelector(".sauce.active");
        const sauce = sauceEl ? sauceEl.dataset.s : "";

        const extraPerUnit =
          Math.max(0, selectedToppings.length - 1) * TOPPING_EXTRA_PRICE;
        const itemTotal = (currentFlavor.price + extraPerUnit) * qty;

        if (editingItemId) {
          const it = cart.find((x) => x.id === editingItemId);
          it.qty = qty;
          it.toppings = selectedToppings;
          it.sauce = sauce;
          it.unitPrice = currentFlavor.price;
        } else {
          cart.push({
            id: "i" + Date.now(),
            flavorName: currentFlavor.name,
            flavorId: currentFlavor.id,
            qty: qty,
            toppings: selectedToppings,
            sauce: sauce,
            unitPrice: currentFlavor.price,
          });
        }

        closeModal();
        renderCart();
      };

      /* Render cart */
      function calcItemTotal(it) {
        const extra = Math.max(0, it.toppings.length - 1) * TOPPING_EXTRA_PRICE;
        return (it.unitPrice + extra) * it.qty;
      }

      function renderCart() {
        const list = $("#cartList");

        // Calculamos total
        let total = 0;
        cart.forEach((it) => (total += calcItemTotal(it)));

        // Si no hay contenedor visual del carrito, al menos actualizamos el footer fijo
        if (!list) {
          const fixedEl = document.getElementById("fixedTotal");
          if (fixedEl) fixedEl.textContent = fmt(total);
          updateFooter(); // Añadido
          return;
        }

        // Renderizar filas del carrito
        list.innerHTML = "";

        if (cart.length === 0) {
          list.innerHTML =
            '<div class="small" style="color:var(--muted)">No hay items todavía</div>';
        } else {
          cart.forEach((it) => {
            const row = document.createElement("div");
            row.className = "cart-row";
            row.innerHTML = `
                  <div>
                      <b>${it.qty}× ${it.flavorName}</b><br>
                      <span class="small">${
                        it.toppings && it.toppings.length
                          ? it.toppings.join(", ")
                          : "Sin toppings"
                      } • ${it.sauce || "Sin salsa"}</span>
                  </div>
                  <div style="text-align:right">
                      <b>${fmt(calcItemTotal(it))}</b><br>
                      <button class="btn btn-ghost" style="margin-top:6px;font-size:12px" onclick="editItem('${
                        it.id
                      }')">Editar</button>
                      <button class="btn btn-ghost" style="margin-top:6px;font-size:12px" onclick="removeItem('${
                        it.id
                      }')">Eliminar</button>
                  </div>
              `;
            list.appendChild(row);
          });
        }

        // Actualizar totales
        const totalEl = document.getElementById("total");
        if (totalEl) totalEl.textContent = fmt(total);

        const fixedEl = document.getElementById("fixedTotal");
        if (fixedEl) fixedEl.textContent = fmt(total);

        updateFooter(); // Añadido
      }

      function editItem(id) {
        editingItemId = id;
        const it = cart.find((x) => x.id === id);
        openModal(it.flavorId, it.flavorName);

        $("#modalQty").value = it.qty;

        // toppings
        $("#modalToppings")
          .querySelectorAll("input")
          .forEach((ch) => {
            if (it.toppings.includes(ch.value)) ch.checked = true;
          });

        // sauce
        $("#modalSauces")
          .querySelectorAll(".sauce")
          .forEach((s) => {
            if (s.dataset.s === it.sauce) s.classList.add("active");
          });

        updateModalPrice();
      }

      function removeItem(id) {
        cart = cart.filter((x) => x.id !== id);
        renderCart();
      }

      /* Delivery select: dirección + reglas de pago */
      $("#deliveryMode").onchange = () => {
        const mode = $("#deliveryMode").value;
        const addr = $("#addressBlock");
        const pay = document.getElementById("paymentMethod");
        const notice = document.getElementById("paymentNotice");
        const cashOpt = pay.querySelector('option[value="cash"]');

        // Mostrar/ocultar dirección
        addr.style.display = mode === "delivery" ? "block" : "none";

        if (mode === "delivery") {
          // Forzar transferencia
          pay.value = "transfer";
          if (cashOpt) cashOpt.disabled = true;

          // Mostrar aviso
          notice.style.display = "block";
        } else {
          // Habilitar efectivo nuevamente
          if (cashOpt) cashOpt.disabled = false;

          // Ocultar aviso
          notice.style.display = "none";
        }
      };

      /* WhatsApp - CORREGIDO para evitar doble alerta */
      function sendWhatsApp() {
        // Prevenir doble envío
        if (isSubmitting) return;
        isSubmitting = true;
        
        setTimeout(() => {
          isSubmitting = false;
        }, 1000);

        if (cart.length === 0) {
          alert("Tu carrito está vacío.");
          isSubmitting = false;
          return;
        }

        let name = $("#custName").value.trim();
        let phone = $("#custPhone").value.trim();
        if (!name) {
          alert("Ingresá tu nombre.");
          isSubmitting = false;
          return;
        }
        if (!phone) {
          alert("Ingresá tu teléfono.");
          isSubmitting = false;
          return;
        }

        let mode = $("#deliveryMode").value;
        let address = $("#custAddress").value.trim();

        if (mode === "delivery" && !address) {
          alert("Ingresá la dirección.");
          isSubmitting = false;
          return;
        }

        let pay = $("#paymentMethod").value;
        let notes = $("#custNotes").value.trim();

        // Construir mensaje legible y seguro
        let text = "Nuevo pedido\n\n";
        cart.forEach((it, i) => {
          text += `${i + 1}) ${it.qty}× ${it.flavorName}\n`;
          text += `Toppings: ${
            it.toppings && it.toppings.length
              ? it.toppings.join(", ")
              : "Sin toppings"
          }\n`;
          text += `Salsa: ${it.sauce || "Sin salsa"}\n`;
          text += `Subtotal: ${fmt(calcItemTotal(it))}\n\n`;
        });

        const totalAmount = cart.reduce((s, it) => s + calcItemTotal(it), 0);
        text += `Total: ${fmt(totalAmount)}\n\n`;
        text += `Cliente: ${name}\nTel: ${phone}\n`;
        text += `Entrega: ${mode === "pickup" ? "Retiro" : "Envío"}\n`;
        if (mode === "delivery") text += `Dirección: ${address}\n`;
        text += `Pago: ${pay === "cash" ? "Efectivo" : "Transferencia"}\n`;
        if (notes) text += `Notas: ${notes}\n`;

        // abrir WhatsApp
        const url = `https://wa.me/${PHONE}?text=` + encodeURIComponent(text);
        window.open(url, "_blank");
        isSubmitting = false;
      }

      /* Función para ir a productos - MEJORADA */
      function scrollToProducts() {
        const productsSection = document.querySelector(".layout");
        if (productsSection) {
          productsSection.scrollIntoView({
            behavior: "smooth",
            block: "start",
          });
        }
      }

      function scrollToForm() {
        const el = document.querySelector(".nice-form");
        if (el) el.scrollIntoView({ behavior: "smooth", block: "start" });
      }

      function clearCart() {
        if (!cart || !cart.length) return;
        if (!confirm("¿Vaciar el carrito?")) return;
        cart = [];
        renderCart();
      }

      function scrollToCart() {
        const formSection = document.querySelector(".nice-form");
        if (formSection) {
          formSection.scrollIntoView({
            behavior: "smooth",
            block: "start",
          });
        }
      }

      /* INIT */
      document.addEventListener("DOMContentLoaded", function () {
        // Inicializar sistema de scroll
        initScrollSystem();
        window.addEventListener("resize", initScrollSystem);

        // Hook botones del footer
        const addBtn = document.getElementById("footerAddBtn");
        if (addBtn) addBtn.addEventListener("click", scrollToProducts);

        const formBtn = document.getElementById("footerFormBtn");
        if (formBtn) formBtn.addEventListener("click", scrollToForm);

        const clearBtn = document.getElementById("footerClearBtn");
        if (clearBtn) clearBtn.addEventListener("click", clearCart);

        // Solo un event listener para el botón fijo
        const fixedSendBtn = document.getElementById("fixedSendBtn");
        if (fixedSendBtn) {
          fixedSendBtn.removeEventListener("click", sendWhatsApp); // Limpiar primero
          fixedSendBtn.addEventListener("click", sendWhatsApp);
        }

        // Solo un event listener para el botón del formulario
        const checkoutBtn2 = document.getElementById("checkoutBtn2");
        if (checkoutBtn2) {
          checkoutBtn2.removeEventListener("click", sendWhatsApp); // Limpiar primero
          checkoutBtn2.addEventListener("click", sendWhatsApp);
        }

        // Inicializar componentes
        renderProducts();
        renderCart();
        updateFooter();
        
        // Asegurar que el scroll funcione correctamente en móviles
        if (window.innerWidth <= 980) {
          setTimeout(() => {
            document.body.style.height = 'auto';
            document.body.style.overflowY = 'auto';
            document.documentElement.style.height = 'auto';
            document.documentElement.style.overflowY = 'auto';
          }, 100);
        }
      });
    </script>
  </body>
</html>
